# esp32-s3-touch-lcd-7.yaml
# Hardware-spezifische Konfiguration für Waveshare ESP32-S3-Touch-LCD-7

esp32:
  variant: esp32s3
  flash_size: 16MB
  cpu_frequency: 240MHz
  framework:
    type: esp-idf
    advanced:
      loop_stack_size: 16384

# PSRAM Konfiguration für Display
psram:
  mode: octal
  speed: 80MHz
  ignore_not_found: false

# I2C Bus
i2c:
  sda: GPIO08
  scl: GPIO09
  scan: false
  id: bus_a

# IO Extender CH422G
ch422g:
  - id: ch422g_hub

# 7" Touch Display Konfiguration
display:
  - platform: rpi_dpi_rgb
    id: my_display
    update_interval: never
    auto_clear_enabled: false
    color_order: RGB
    pclk_frequency: 16MHz
    dimensions:
      width: 800
      height: 480
    # Control Pins
    de_pin:
      number: 5
    hsync_pin:
      number: 46
      ignore_strapping_warning: true
    vsync_pin:
      number: 3
      ignore_strapping_warning: true
    pclk_pin: 7
    pclk_inverted: true
    # Reset & Enable über CH422G
    reset_pin:
      ch422g: ch422g_hub
      number: 3
    enable_pin:
      ch422g: ch422g_hub
      number: 2
    # Timing Konfiguration
    hsync_back_porch: 8
    hsync_front_porch: 8
    hsync_pulse_width: 4
    vsync_back_porch: 16
    vsync_front_porch: 16
    vsync_pulse_width: 4
    # Daten Pins
    data_pins:
      red:
        - 1    # r3
        - 2    # r4
        - 42   # r5
        - 41   # r6
        - 40   # r7
      blue:
        - 14   # b3
        - 38   # b4
        - 18   # b5
        - 17   # b6
        - 10   # b7
      green:
        - 39   # g2
        - 0    # g3
        - 45   # g4
        - 48   # g5
        - 47   # g6
        - 21   # g7

# Touchscreen GT911
touchscreen:
  platform: gt911
  id: my_touch
  interrupt_pin: GPIO4
  reset_pin:
    ch422g: ch422g_hub
    number: 1
    mode: OUTPUT
  on_touch:
    - lambda: |-
        ESP_LOGD("touch", "x=%d, y=%d, state=%d", touch.x, touch.y, touch.state)
